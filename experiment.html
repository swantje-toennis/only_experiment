<!DOCTYPE html>
<!-- ';' marks the end of a statement, ',' marks that the same statement is continued-->
<html> <!--Inside of head and html, comment like this -->
    <head>     
        <title>Q-Experiment</title>
        <script src="jspsych/jspsych.js"></script>

<!-- include here all the plugins that you want to use, e.g., slider --> 
        <script src="jspsych/plugin-survey.js"></script>
        <script src="jspsych/plugin-html-button-response.js"></script>
        <script src="jspsych/plugin-html-slider-response-JT.js"></script> <!-- slider modified by Judith-->
        <script src="jspsych/plugin-html-keyboard-response.js"></script> <!-- Include this for adding a link to be redirected to Prolific-->
        <script src="jspsych/plugin-survey-text.js"></script> <!-- plugin for entering text-->  
        <script src="jspsych/plugin-instructions.js"></script> <!--plugin for instructions and consent-->   
        <script src="jspsych/plugin-survey-multi-choice.js"></script> <!--plugin for multiple choice response-->
        <script src="jspsych/plugin-survey-html-form.js"></script>

        <!-- add this for the css part: to determine how things look-->   
        <link  href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />   
        <link rel="stylesheet" href="https://unpkg.com/@jspsych/plugin-survey@0.2.2/css/survey.css"> 
    </head>
    <body></body><!-- iclude this and leave it empty -->   
<!-- Script starts here -->
<script> // Inside of script comment using //



/* Send data data to store script: */

async function saveData(data){
  const response = await fetch('/store', {
    method:  "POST",
    cache:   "no-cache",
    headers: {"Content-Type": "text/csv"},
    body:    data
    })
  await new Promise(r => setTimeout(r, 4000));
  document.getElementById("jspsych-content").innerHTML = await response.text();
}

/* initialize jsPsych */
var jsPsych = initJsPsych({
  on_finish: async function(){
    await saveData(jsPsych.data.get().csv());
  }
});

// this function shuffles an array
function shuffle(array) {
   for (var i = array.length - 1; i > 0; i--) { 
  
       // Generate random number 
       var j = Math.floor(Math.random() * (i + 1));
                  
       var temp = array[i];
       array[i] = array[j];
       array[j] = temp;
   }
         
   return array;
}

// put the instructions here (needs instructions plugin)  
var instructions = {
    type: jsPsychInstructions,
    name: 'instructions',
            pages: ['<p><span style="font-size:30px;"> Welcome to our study! </span></p>\
            <div style="max-width:800px; word-wrap:break-word;text-align:left;"><p>The goal of this study is to investigate how humans understand and interpret English utterances.\
            We will ask you to read one conversation between two/three persons. We will describe the context in which the conversation takes place. You might see text in brackets.\
            It describes what is happening in the situation besides what is said. After you&apos;ve read the conversation: </p>\
            <p> 1. We will ask you to guess what one of the persons asked next.</p>\
            <p>2. We will then show to you what the other person replied and will ask you to guess again what might have been asked.</p>\
            <p>3. We will ask you to answer a multiple choice comprehension question about the conversation. So, please pay close attention during the study!</p>\
            <p>4. Finally, we will ask you for your demographic data.</p><p>The study should take approximately XX minutes. </p>\
            <p>On the next page, you can go through a practice trial in which you will read a conversation between Bill and Joan.</p></div>'],
            show_clickable_nav: true
        };


//Practice 1: Q elicitation after context        
var practice1 = {
    type: jsPsychSurveyHtmlForm,
    name: 'practice1',
    html: '<p><span style="font-size:30px;"> Practice - task 1 </span></p><div style="max-width:800px; word-wrap:break-word;text-align:left;"> \
        <p>Context: Bill and Joan have been friends since middle school. They are now in their thirties and at a bar together. Imagine that you are overhearing their conversation. </p>\
        <p> Joan: How come you had to buy a new car?<br>\
        Bill: Well, you know how my old car was a red Porsche, right? One of the headlights was acting up, and I took it to the shop.<br>\
        Joan: <input type="text" id="test-resp-box" name="practice_elicit" size="80" required = true /> ?</p>\
       <p><br><b>You noticed that Joan reacted to what Bill said by asking something,\
        but you couldn&apos;t hear what. What did Joan ask? Please make a guess in the box above!</b></p><br><br><p></p></div>',
  autofocus: 'test-resp-box',
    }; 


// Practice 2: Q eleicitation after reply
var practice2 = {
    type: jsPsychSurveyHtmlForm,
    name: 'practice2',
    html: '<p><span style="font-size:30px;"> Practice - task 2 </span></p><div style="max-width:800px; word-wrap:break-word;text-align:left;"> \
        <p>Context: Bill and Joan have been friends since middle school. They are now in their thirties and at a bar together. Imagine that you are overhearing their conversation. </p>\
        <p> Joan: How come you had to buy a new car?<br>\
        Bill: Well, you know how my old car was a red Porsche, right? One of the headlights was acting up, and I took it to the shop.<br>\
        Joan: <input type="text" id="test-resp-box" name="practice_reply" size="80" required = true /> ?</p>\
        <p><br><b>Now you still don&apos;t know what Joan asked, but you heard Bill&apos;s reply:</b>\
        </p><p>Bill: I took it to "Motor City South" two weeks ago.</p> <p> <b>What was it that Joan asked? Please guess again above!</b> </p> </div>',
  autofocus: 'test-resp-box'
    };      
    
/* Practice with two options (expluded from experiment)
var practice3 = {
    type: jsPsychSurveyMultiChoice,
    name: 'practice3',
    preamble: '<p><span style="font-size:30px;"> Practice </span></p><div style="max-width:800px; word-wrap:break-word;text-align:left;"> \
    <p>Context: Bill and Joan have been friends since middle school. They are now in their thirties and at a bar together. Imagine that you are overhearing their conversation. </p>\
    <p> Joan: How come you had to buy a new car?<br>\
    Bill: Well, you know how my old car was a red Porsche, right? One of the headlights was acting up, and I took it to the shop.<br>\
    Joan: ...?',
    questions: [
        {prompt: '<b>Now, choose between the 2 options of what Joan could have asked:</b>',
        options: shuffle(['To which repair shop did you take it?', 'When was that?']), 
        required: true
        },
    ],
    };
*/

// Comprehension practice
var practice_comprehension = {
    type: jsPsychSurveyMultiChoice,
    name: 'practice_comprehension',
    preamble: '<p><span style="font-size:30px;"> Practice - Comprehension </span></p>',
    questions: [
        {
        prompt: 'Where do Joan and Bill know each other from?', 
        name: 'practice_comprehension', 
        options: shuffle(['From repairing cars together.', 'From middle school.', 'They are siblings.']), 
        required: true,
        },
    ],  
};

//consent
    var consent = {
    type: jsPsychHtmlButtonResponse,
    stimulus: '<p><span style="font-size:30px;"> Consent </span></p><div style="max-width:800px; word-wrap:break-word;text-align:left;">\
        By clicking on the "I want to participate"-button below, you agree to participate in this study,\
        which is conducted by researchers at the University of Stuttgart. You may withdraw from this experiment\
        at any time. The data collected will be anonymous and confidential. You give permission\
        for your data from this study to be shared with other researchers provided that your anonymity is completely\
        protected. If you have any questions, you may contact the requester through Prolific&apos;s platform or via email\
        (swantje.toennis@ling.uni-stuttgart.de).</div><br>',
    choices: ['I want to participate']
    };

// Start page
var start_page = {
    type: jsPsychHtmlButtonResponse,
    stimulus: 'OK, let&apos;s get started. On the next page you will read a conversation between Jay and Doris. <br><br>',
    choices: ['Start the study']
    };


// Define experiment trial in which participants must enter a question:
var experiment_trial1 = {
    type: jsPsychSurveyHtmlForm,
    name: 'task_elicit',
    html: '<div style="max-width:800px; word-wrap:break-word;text-align:left;"> <p>Context: Imagine that you are overhearing a conversation between Jay\
        and his friend Doris, who has read a screenplay he just completed. </p> \
        <p> Doris: Jay, I just finished your screenplay.<br>\
        Jay: Really? Oh, what did you think?<br>\
        Doris: Oh, it&apos;s wonderful. It really is. <br>\
        Jay: That means so much to me. <br>\
        Doris: <input type="text" id="test-resp-box" name="q_elicit" size="80" required = true /> ?</p>\
        <p><br><b>You noticed that Doris reacted to what Jay said by asking something, but you couldn&apos;t hear what.\
        What did Doris ask? Please make a guess in the box above!</b></p><br><br><p></p></div>',
    autofocus: 'test-resp-box',
    on_finish: function(data) {
                var item = 'itemx'; // change to item number of respective item
                data.item = item;
            }            
    };

var experiment_trial2 = {
    type: jsPsychSurveyHtmlForm,
    name: 'task_reply',
    html: '<div style="max-width:800px; word-wrap:break-word;text-align:left;"> <p>Context: Imagine that you are overhearing a conversation between Jay\
        and his friend Doris, who has read a screenplay he just completed. </p> \
        <p> Doris: Jay, I just finished your screenplay.<br>\
        Jay: Really? Oh, what did you think?<br>\
        Doris: Oh, it&apos;s wonderful. It really is. <br>\
        Jay: That means so much to me. <br>\
        Doris: <input type="text" id="test-resp-box" name="practice_reply" size="80" required = true /> ?</p>\
        <p><br><b>Now you still don&apos;t know what Doris asked, but you heard Jay&apos;s reply:</b>\
        </p><p>Jay: You know, I only showed it to my closest friends.</p> <p> <b>What was it that Doris asked? Please guess again above!</b> </p> </div>',
    autofocus: 'test-resp-box',
    on_finish: function(data) {
        var item = 'itemx'; // change to item number of respective item
        data.item = item;
        }
    };

/* Trial with two options  (excluded from experiment)    
    var experiment_trial3 = {
    type: jsPsychSurveyMultiChoice,
    name: 'task_options',
    preamble: '<div style="max-width:800px; word-wrap:break-word;text-align:left;"> <p>Context: Imagine that you are overhearing a conversation between Jay\
        and his friend Doris, who has read a screenplay he just completed. </p> \
        <p> Doris: Jay, I just finished your screenplay.<br>\
        Jay: Really? Oh, what did you think?<br>\
        Doris: Oh, it&apos;s wonderful. It really is. <br>\
        Jay: That means so much to me. <br>\
        Doris: ...?',
    questions: [
        {prompt: '<b>Now, choose between the 2 options of what Doris could have asked:</b>',
        options: shuffle(['Who did you show it to?', 'What did you show to your closest friends?']), 
        required: true
        },
    ],
    };
*/

// Comprehension question
var comprehension = {
    type: jsPsychSurveyMultiChoice,
    name: 'comprehension',
    preamble: '<p><span style="font-size:30px;"> Comprehension </span></p>',
    questions: [
        {
        prompt: 'What did Jay write?', 
        name: 'comprehension', 
        //columns: 4,
        options: shuffle(['A short story.', 'A letter.', 'A screenplay.']),
        required: true,
        },
    ],  
};

// demographic information
var demographics = {
  type: jsPsychSurvey,
  button_label_finish: 'Continue',
  title: 'Demographics',
  pages: [
    [
      {
        type: 'html',
        prompt: 'Please answer these demographic questions truthfully. You will be paid no matter what you respond here.',
      },
      {
        type: 'text',
        prompt: "How old are you?", 
        name: 'age', 
        textbox_columns: 3, 
        autofocus: true,
        required: true,
      }, 
      {
        type: 'multi-choice',
        prompt: "What is your gender?", 
        name: 'gender', 
        columns: 4,
        options: ['female', 'male', 'non-binary', 'prefer not to say'], 
        required: true,
      },
      {
        type: 'multi-choice',
        prompt: "Are you a native speaker of English?",
        name: 'language',
        columns: 2, 
        options: ['yes', 'no'], 
        required: true,
      },
      {
        type: 'multi-choice',
        prompt: "Are you a speaker of American English (as opposed to, e.g., Indian English)?",
        name: 'amE', 
        columns: 2,
        options: ['yes', 'no'], 
        required: true,
      },
      {
        type: 'text',
        prompt: "We are interested in any other comments you might have about this study. Please type them in the box:", 
        name: 'comments', 
        textbox_columns: 40, 
        textbox_rows: 2,
        required: false
      }
    ]
  ],
}

        
/*//demographics part 1
var demographics1 = {
    type: jsPsychSurveyMultiChoice,
    name: 'demographics',
    preamble: '<p><span style="font-size:30px;"> Demographics </span></p><div style="max-width:800px; word-wrap:break-word;text-align:left;"> \
        Please answer these demographic questions truthfully. You will be paid no matter what you respond here. </div>',
    questions: [
        {
        prompt: 'What is your gender?', 
        name: 'gender', 
        options: ['female', 'male', 'non-binary', 'prefer not to say'], 
        //horizontal: true,
        required: true,
        },
        {
        prompt: 'Are you a native speaker of English?',
        name: 'language', 
        options: ['yes', 'no'], 
        required: true,
        },
        {prompt: 'Are you a speaker of American English (as opposed to, e.g., Indian English)?',
        name: 'amE', 
        options: ['yes', 'no'], 
        required: true
        }
    ],   
};


// demographic information - part 2
var demographics2 = {
    type: jsPsychSurveyText,
    name: 'demographics',
    preamble: '<p><span style="font-size:30px;"> Demographics </span></p>',
    questions: [
        {prompt: 'How old are you?', 
        name: 'age',
        required: true}, 
        {prompt: 'We are interested in any other comments you might have about this study. Please type them in the box:',  
        name: 'feedback',
        rows: 5, columns:70, 
        required: false}
        ],
    };
*/

// Final screen showing completion code and redirects participants to Prolific
 var final_screen = {
  type: jsPsychHtmlKeyboardResponse,
  name: 'final screen',
  stimulus: `<p>You&apos;ve finished the last task. Thanks for participating!<br> Completion code: <b> 16A7637A</p>
    <p>Or click <a href="https://app.prolific.com/submissions/complete?cc=16A7637A">here</a> to return to Prolific and complete the study.</p>`,
  choices: "NO_KEYS"
}



// Add all parts to the timeline to be included in the experiment
var full_timeline = [
  instructions,
  practice1,
  practice2,
  practice_comprehension,
  consent,
  start_page,
  experiment_trial1,
  experiment_trial2,
  comprehension,
  demographics,
  final_screen
];

// Run the experiment
jsPsych.run(full_timeline);

  </script>
</html>
